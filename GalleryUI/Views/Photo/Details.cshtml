@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/Scripts/Tool.js"></script>
<script>
    var photoId = getParamValue('photoId');
    if (!photoId)
        window.location.href = "/";
    $(function () {
        load();
    });

    function load() {
        $.ajax({
            url: '/Photo/GetDetails?photoId=' + photoId,
            type: 'get',
            success: function (data) {
                if (data.StatusCode === 1) {
                    init(data.Data);
                } else {
                    return layer.alert(data.Message, { icon: 3, skin: 'layer-ext-moon' });
                }
            }
        });
    }

    function init(json) {
        //alert(json.Name);
        $('#photoName').text(json.Name);
        $('#imgRul').attr('src', json.ImgUrl);
        setSupCount(json.LikeCount);
        $('#userName').text(json.User.Name);
        initLastImg(json.ListLastPhotos);
        initComment(json.ListComment)
    }

    function setSupCount(count) {
        $('#supCount').text(count);
    }

    function initComment(json) {
        var comment = '';
        $.each(json, function () {
            comment += '<div class="media mainborder"><a class="pull-left" href="#"><img class="media-object" src="/images/touxiang.png" style="width:50px;height:50px;" alt="作者"></a><div class="media-body"><h4 class="media-heading"><lable>' + this.User.Name + '</lable><a style="position: relative; float: right; font-size: 10px; cursor: pointer;">回复</a></h4>' + this.Content + '</div></div>';
        });
        
        $('#comment').html(comment);
    }
    
    function initLastImg(json) {
        var lastImg = '';
        $.each(json, function () {
            lastImg += '<a href="/photo/details?photoId=' + this.PhotoId + '"><div><img src="' + this.ImgUrl + '" /></div></a>';
        });
        $('#lastPhotos a').remove();
        $('#lastPhotos').prepend(lastImg);
    }



    function submit() {
        var content = $('#content').val();
        if(!content)
        {
            layer.msg('评论内容不能为空');
            $('#content').focus();
            return;
        }
        $.ajax({
            url: '/comment/AddComment',
            type: 'post',
            data: { content: content, photoId: photoId, upId: 0 },
            success: function (data) {
                if (data.StatusCode == 1)
                {
                    load();
                    $('#content').val('');
                } else
                layer.msg(data.Message);
            }
        });
    }

    function support() {
        $.ajax({
            url: '/like/AddLike',
            type: 'post',
            data: { photoId: photoId },
            success: function (data) {
                if(data.StatusCode==1)
                {
                    setSupCount(data.Data.Count);
                }else
                {
                    layer.msg(data.Message);
                }
            }
        });
    }


</script>
<style>
    .main {
        width: 60%;
        margin: auto;
    }

    .detial {
        margin:auto;
        width: 99%;
    }
    

    .imgs img {
        display: inline-block;
        cursor: pointer;
    }

    .imgs div {
        width: 48%;
        height: 7em;
        display: inline-block;
        margin-bottom: 2px;
        overflow: hidden;
    }
    .mainborder {
        padding: 4px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-top: 1em;
    }
    .imgs {
        position: relative;
    }
</style>

<div class="main">
    <h2 id="photoName"></h2>
    <div class="col-lg-9">
        <div class="detial">
            <img src="/Upload/Images/2758874a528a4578a805b084ddac9407.jpg" id="imgRul" class="img-thumbnail" style="margin:auto;" />
            <div class="mainborder" style="margin-top:1em;">
                <a style="cursor:pointer;margin-left:50%;" onclick="support()">赞<label id="supCount">0</label></a>
            </div>
        </div>
        <div class="detial mainborder" id="comment">
            @*<div class="media mainborder">
                <a class="pull-left" href="#">
                    <img class="media-object" src="~/images/touxiang.png" style="width:50px;height:50px;" alt="作者">
                </a>
                <div class="media-body">
                    <h4 class="media-heading">作者姓名<a style="position: relative; float: right; font-size: 10px; cursor: pointer;">回复</a></h4>
                    这张图很有逼格。这张图很有逼格。
                    <div class="media mainborder">
                        <a class="pull-left" href="#">
                            <img class="media-object" src="~/images/touxiang.png" style="width:50px;height:50px;"
                                 alt="作者">
                        </a>
                        <div class="media-body">
                            <h4 class="media-heading">作者姓名<a style="position: relative; float: right; font-size: 10px; cursor: pointer;">回复</a></h4>
                            这张图很有逼格。这张图很有逼格。
                        </div>
                    </div>
                </div>
            </div>*@
            
        </div>
        <div class="detial mainborder">
            <textarea class="mainborder" id="content" style="margin:auto;width:100%;"></textarea>
            <input type="button" onclick="submit()" value="评论" class="btn-default" style="position:relative;float:right;" />
            <div class="clear"></div>
        </div>
    </div>
    <div class="col-lg-3" style="padding: 4px; border: 1px solid #ddd; border-radius: 4px;">
        <div style="margin-bottom:1em;margin-top:1em;"><span id="userName"></span></div>
        <div class="imgs" id="lastPhotos">
           
            <div class="clear"></div>
        </div>

    </div>
    <div class="clear"></div>
</div>


